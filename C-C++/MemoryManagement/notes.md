# C/C++ メモリ管理

## 1. メモリ領域の全体像

### 1.2 メモリ領域の使われ方

 <figure style="text-align:center;">
<img width="500" src="./images/memory_using.drawio.png">
<figcaption>図１　メモリ領域の全体像</figcaption>
</figure>

各領域の役割は以下の通り。

- **テキスト領域**：プログラム命令（機械語）が格納される。 CPU がこの命令順に実行してプログラムが動作する。
- **静的領域**：グローバル変数などの静的変数が置かれる。プログラム開始から終了まで存続。
- **ヒープ領域**：メモリの動的管理 (C 言語の malloc 関数や C++ の new 演算子でメモリを確保すること) で用いられる。手動管理のため解放操作が必要。
- **スタック領域**：ローカル変数（自動変数）や呼び出し関数の戻り値、引数が置かれる。自動管理のためスコープ終了時に自動的に解放される。

# 2. C のメモリ管理

## 2.1 スタック変数

```c
int func(int a int* b){
    int x = 10;
    int arr[5];

    return x
}
```

```
高アドレス
|-------------------|
| （未使用領域）     |
|-------------------|
| arr[4]            |
| arr[3]            |
| arr[2]            |
| arr[1]            |
| arr[0]            | ← ローカル配列
| x                 | ← ローカル変数
| b                 | ← 引数ポインタ
| a                 | ← 引数
| 戻りアドレス       | ← 呼び出し元のアドレス
低アドレス
```

自動的にスコープ終了時に解放される

2.2 ヒープ変数
int* p = (int*)malloc(5 \* sizeof(int));
free(p);

malloc/free を組み合わせる必要がある

初期化やエラー処理は自分で行う

graph TD
StackVar[スタック変数 x, arr]
HeapVar[ヒープ変数 p]
StackVar -->|スコープ終了で自動解放| NULL
HeapVar -->|free()で手動解放| NULL
